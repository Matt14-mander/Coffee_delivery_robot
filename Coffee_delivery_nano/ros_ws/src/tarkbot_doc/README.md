# ROS 多机通信与导航调试记录（2025年5月）

本项目记录了在 ROS 系统中调试 Cartographer 和 GMapping 两种建图算法，并解决多机通信、导航控制、传感器问题的全过程。内容涉及网络配置、TF树连接、Rviz可视化问题、传感器插接错误等，供后续开发与排错参考。

---

## 📅 问题与解决过程

### 2025-05-06：导航目标点无响应 & 地图原点不可设置

**问题描述：**
- 在 RViz 中设置导航目标点后，小车无响应；
- 无法设置地图原点；
- 调整虚拟机为桥接模式未解决；
- 配置 `~/.bashrc` 后依然无效。

**初步排查：**
- 确认为 **ROS多机通信配置问题**；
- 虚拟机使用桥接模式，并配置了虚拟网络适配器（当时设为静态IP）；
- 尝试 Wheeltec 平台下重新配置。

**备用方案：**
- 使用 Jetson Nano 开热点；
- 根据教程创建新 WiFi 但未连接隐藏网络；
- 视频提示：连接隐藏网络后才会发出 WiFi 信号（待测试）。

---

### 📌 Cartographer 使用笔记

- **回环检测机制**：与 Gmapping 不同，Cartographer 需要在同一区域反复移动，才能有效构建地图并填补空缺区域；
- **玻璃穿透效果更好**，受反射干扰小，建图更加精准；
- **滤波与融合机制复杂**，对弱激光反射数据处理更智能。

---

### ⚠️ 警告信息排查
```bash
[ WARN] [1746533104.449630629]: MSG to TF: Quaternion Not Properly Normalized
```


- 非代码或进程冲突问题；
- 切换算法无效；
- 怀疑电量不足，数据上传抖动，传感器数据受影响。

---

### 🛠️ 雷达节点丢失问题修复

- 报错：找不到雷达节点；
- 原因：`devel` 文件夹缺少节点文件；
- 解决：从官方驱动文件夹中复制缺失节点。

---

### 🔧 TF 树连接 & URDF 模型加载问题

- 报错：Map -> Odom 没有连接 Base_link；
- 原因：未加载 URDF 模型，TF 树不完整；
- 手动启动 RViz 报错 `[rospack] not found tarkbot_description`；
- 原因：新开终端未 `source devel/setup.sh`；
- 解决：每个终端都需执行 `source`；
- 📝 提示：虚拟机端也需安装一份相同的工作空间。

---

### 2025-05-07 ~ 05-08：导航通信机制原理与配置

**问题复现：**
- RViz 发布导航目标点小车不动；
- 地图原点无法设置。

**最终解决方案：**
- 连接实验室 WiFi `OUC@c108`；
- 虚拟机设置桥接模式，网络配置自动；
- 使用 `ifconfig` 获取 IP 并配置静态 IP；
- 结果：导航点控制成功。

**原理分析：**

- **键盘控制基于 Topic（单向广播）**
  ```bash
  rostopic pub /cmd_vel geometry_msgs/Twist ...
  ```
- 仅需找到订阅者，IP 不固定也能工作。

- 导航目标基于 Action（双向通信）

  - 包含 goal / feedback / result；

  - 建立 TCP 回调连接；

  - 若未配置 ROS_IP 和静态 IP：

    - 会造成目标请求发送成功但反馈失败；

    - 导致导航流程卡住、小车不动。

### 2025-05-09：roslaunch 无响应 & 网络段冲突
**问题现象：**

- roslaunch / roscore 命令无响应；

- 第一次 Ctrl+C 出现日志，第二次才退出。

**原因分析：**

- .bashrc 中配置的 ROS_MASTER_URI 包含固定 IP；

- 实验室网段 192.168.*.*，宿舍校园网段 10.169.0.*；

- 使用 NAT 模式造成网络不通。

**解决方案：**

- 修改 .bashrc，注释或修改 ROS_MASTER_URI；

- 根据实际网段调整为可通信 IP。

### 2025-05-10：麦克风阵列无法收音问题
**问题描述：**

- 成功连接串口，可用工具修改唤醒词；

- 但麦克风未收到声音。

**排查过程：**

- 软排线插反；

- 重新插入后恢复正常。

**改进方案：**

- 使用 WonderEcho 模块：

- 4-pin 接信号转接板；

- USB 接口独立连接至电脑。

### 2025-05-12：Cartographer 与 Gmapping 对玻璃门响应差异
**1. 激光雷达的玻璃穿透问题（硬件层面）**
- 大部分激光雷达难以检测玻璃；

- 工作波长、功率及接收器灵敏度影响其探测能力；

- 属于物理层面限制，与算法无关。

**2. 算法层面对比**
- Cartographer 优势：

  - 融合 IMU、里程计、回环检测；

  - 使用 TSDF 或概率建图，抗干扰能力强；

  - 可推测出玻璃处障碍。

**Gmapping 弱点：**

- 粒子滤波，依赖激光帧数据；

- 对玻璃穿透敏感，易将玻璃当作通道处理。